version: q123
applications:
  - name: test
    deployment:
      replicas: 1
      image:
        repository: ghcr.io/obervinov/test
      extraLabels:
        app: test
        version: q123123
        env: dev
      envs:
        BOT_NAME: "tests"
        VAULT_ADDR: "http://vault.vault.svc.cluster.local:8200"
        LOGGER_LEVEL: INFO
        STORAGE_TYPE: mega
        INSTAGRAM_SESSION: "/home/python/.config/instaloader/session"
        STORAGE_EXCLUDE_TYPE: ".txt"
        MESSAGES_CONFIG: "configs/messages.json"
      envsSecret:
        - name: VAULT_APPROLE_ID
          keySecret: vault-approle-id
        - name: VAULT_APPROLE_SECRETID
          keySecret: vault-approle-secret-id
      resources:
        requests:
          memory: "128"
          cpu: null
        limits:
          memory: "256Mi"
          cpu: null
      nodeSelector:
        service: python
      tolerations:
        - key: workloadKind
          operator: Equal
          value: python
          effect: NoSchedule
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                - key: service
                  operator: In
                  values:
                    - python
      volume:
        name: data
        mountPath: /data
        type: persistentVolumeClaim
        claimName: data-pyinstabot-downloader-dev

    persistentVolumes:
      - name: data-pyinstabot-downloader-dev
        storageClassName: do-block-storage
        accessModes: ["ReadWriteMany"]
        size: 1Gi